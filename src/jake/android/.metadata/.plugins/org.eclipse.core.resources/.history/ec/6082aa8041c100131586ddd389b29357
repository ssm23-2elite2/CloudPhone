package com.example.cloudphonesimpletest.network;

public class Packet {
	public static final int MAX_LENGTH = 4096;
	public static final int MAX_PAYLOAD_LENGTH = MAX_LENGTH - PacketHeader.LENGTH;
	
	private PacketHeader header;
	
	private static byte[] packetBuffer = new byte[MAX_LENGTH];
	private static byte[] payloadBuffer = new byte[MAX_PAYLOAD_LENGTH];
	private byte[] payload;
	
	protected Packet(){
	
	}
	
	public Packet(int opCode, byte[] data, int dataLength){
		header = new PacketHeader(opCode, dataLength);
		payload = data;
	}
	
	public static Packet parse(byte[] rawPacket){
		Packet packet = new Packet();		
		// Get header
		packet.setHeader(PacketHeader.parse(rawPacket));		
		
		int payloadLength = packet.getHeader().getPayloadLength();

		// Get data (payload)
		System.arraycopy(rawPacket, PacketHeader.LENGTH, payloadBuffer, 0, payloadLength);
		packet.setPayload(payloadBuffer);		
		// Packet parsing has done.
		return packet;
	}
}
